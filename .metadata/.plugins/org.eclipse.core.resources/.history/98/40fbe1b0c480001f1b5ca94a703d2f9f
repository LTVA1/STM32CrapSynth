/*
 * rtc.c
 *
 *  Created on: 2 окт. 2024 г.
 *      Author: georg
 */

#include "stm32f3xx.h"

void rtc_init()
{
	RTC->WPR = 0xCA;
	RTC->WPR = 0x53;

	RTC->CR &= RTC_CR_WUTE;

	while(!(RTC->ISR & RTC_ISR_WUTWF)) {}

	RTC->CR &= RTC_CR_WUCKSEL;
	RTC->CR |= RTC_CR_WUCKSEL_2;
	RTC->CR |= RTC_CR_WUTIE;

	RTC->PRER = 0; // disable prescalers

	//RTC_CR_WUCKSEL_1 is used as 17th bit in autoreload value. RTC->WUTR is the autorealod reg
	//RTC->CR |= RTC_CR_WUTE;
}
